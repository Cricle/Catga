name: Benchmarks

on:
  workflow_dispatch:
    inputs:
      benchmark:
        description: 'Benchmark to run'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - CqrsPerformance
          - BusinessScenario
          - ConcurrencyPerformance

jobs:
  benchmark-cqrs:
    if: inputs.benchmark == 'all' || inputs.benchmark == 'CqrsPerformance'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '9.0.x'
      - name: Run CQRS Benchmarks
        run: dotnet run -c Release --project benchmarks/Catga.Benchmarks --filter *CqrsPerformance*
      - uses: actions/upload-artifact@v4
        with:
          name: benchmark-cqrs
          path: BenchmarkDotNet.Artifacts/

  benchmark-business:
    if: inputs.benchmark == 'all' || inputs.benchmark == 'BusinessScenario'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '9.0.x'
      - name: Run Business Scenario Benchmarks
        run: dotnet run -c Release --project benchmarks/Catga.Benchmarks --filter *BusinessScenario*
      - uses: actions/upload-artifact@v4
        with:
          name: benchmark-business
          path: BenchmarkDotNet.Artifacts/

  benchmark-concurrency:
    if: inputs.benchmark == 'all' || inputs.benchmark == 'ConcurrencyPerformance'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '9.0.x'
      - name: Run Concurrency Benchmarks
        run: dotnet run -c Release --project benchmarks/Catga.Benchmarks --filter *ConcurrencyPerformance*
      - uses: actions/upload-artifact@v4
        with:
          name: benchmark-concurrency
          path: BenchmarkDotNet.Artifacts/
