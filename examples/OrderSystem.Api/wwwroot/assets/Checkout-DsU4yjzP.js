import{k as z,r as y,q as g,L as e,c as w,w as a,a4 as o,v as n,C as l,x as u,u as d,ad as D,F as L,D as M,o as m}from"./vue-DxbRKzch.js";import{u as R}from"./index-BeNiinvJ.js";import{u as U}from"./order-Cp0QkwRJ.js";import"./vuestic-BlKE5WT7.js";import"./index-Ca5JJS8k.js";import"./index-B9ygI19o.js";const P={class:"text-secondary mb-4"},T={key:1,class:"row"},A={class:"flex md8 xs12"},G={class:"d-flex align-center"},H={class:"flex md4 xs12"},J={class:"d-flex justify-space-between mb-2"},K={class:"d-flex justify-space-between mb-4"},Q={class:"text-danger",style:{"font-size":"1.5rem"}},at=z({__name:"Checkout",setup(W){const p=D(),i=R(),I=U(),b=y(!1),C=y("alipay"),S=y(!1),q=y(""),V=[{value:"alipay",label:"支付宝",icon:"account_balance_wallet"},{value:"wechat",label:"微信支付",icon:"qr_code_2"},{value:"card",label:"银行卡",icon:"credit_card"}],O=async()=>{if(!i.isEmpty){b.value=!0;try{const v=await I.createOrder({customerId:"USER-"+Date.now().toString(36),items:i.items.map(t=>({productId:t.productId,productName:t.name,quantity:t.quantity,unitPrice:t.price}))});q.value=v.orderId,S.value=!0,i.clear()}catch(v){console.error("Order failed:",v)}finally{b.value=!1}}};return(v,t)=>{const r=o("va-icon"),f=o("va-card-title"),c=o("va-card"),_=o("va-button"),B=o("va-avatar"),x=o("va-list-item-section"),F=o("va-list-item-label"),E=o("va-list-item"),N=o("va-list"),k=o("va-card-content"),$=o("va-option-list"),j=o("va-divider");return m(),g("div",null,[e(c,{class:"mb-4"},{default:a(()=>[e(f,null,{default:a(()=>[e(r,{name:"payment",class:"mr-2"}),t[5]||(t[5]=n(" 结算 ",-1))]),_:1})]),_:1}),S.value?(m(),w(c,{key:0,class:"text-center pa-6"},{default:a(()=>[e(r,{name:"check_circle",size:"4rem",color:"success"}),t[8]||(t[8]=l("h2",{class:"mt-4"},"订单提交成功！",-1)),l("p",P,"订单号: "+u(q.value),1),e(_,{color:"primary",class:"mr-2",onClick:t[0]||(t[0]=s=>d(p).push("/my-orders"))},{default:a(()=>[e(r,{name:"receipt_long",class:"mr-2"}),t[6]||(t[6]=n(" 查看订单 ",-1))]),_:1}),e(_,{preset:"secondary",onClick:t[1]||(t[1]=s=>d(p).push("/"))},{default:a(()=>[e(r,{name:"store",class:"mr-2"}),t[7]||(t[7]=n(" 继续购物 ",-1))]),_:1})]),_:1})):d(i).isEmpty?(m(),w(c,{key:2,class:"text-center pa-6"},{default:a(()=>[e(r,{name:"remove_shopping_cart",size:"4rem",color:"secondary"}),t[17]||(t[17]=l("h3",{class:"mt-4"},"购物车是空的",-1)),e(_,{class:"mt-4",onClick:t[4]||(t[4]=s=>d(p).push("/"))},{default:a(()=>[e(r,{name:"store",class:"mr-2"}),t[16]||(t[16]=n(" 去购物 ",-1))]),_:1})]),_:1})):(m(),g("div",T,[l("div",A,[e(c,{class:"mb-4"},{default:a(()=>[e(f,null,{default:a(()=>[n("订单商品 ("+u(d(i).count)+" 件)",1)]),_:1}),e(k,null,{default:a(()=>[e(N,null,{default:a(()=>[(m(!0),g(L,null,M(d(i).items,s=>(m(),w(E,{key:s.productId},{default:a(()=>[e(x,{avatar:""},{default:a(()=>[e(B,{color:"backgroundSecondary"},{default:a(()=>[e(r,{name:s.image,color:"primary"},null,8,["name"])]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[e(F,null,{default:a(()=>[n(u(s.name),1)]),_:2},1024),e(F,{caption:""},{default:a(()=>[n("¥"+u(s.price.toFixed(2))+" × "+u(s.quantity),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:a(()=>[l("strong",null,"¥"+u((s.price*s.quantity).toFixed(2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(c,{class:"mb-4"},{default:a(()=>[e(f,null,{default:a(()=>[...t[9]||(t[9]=[n("支付方式",-1)])]),_:1}),e(k,null,{default:a(()=>[e($,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=s=>C.value=s),type:"radio",options:V,"value-by":"value","text-by":"label"},{default:a(({option:s})=>[l("div",G,[e(r,{name:s.icon,class:"mr-2"},null,8,["name"]),n(" "+u(s.label),1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),l("div",H,[e(c,null,{default:a(()=>[e(f,null,{default:a(()=>[...t[10]||(t[10]=[n("订单摘要",-1)])]),_:1}),e(k,null,{default:a(()=>[l("div",J,[t[11]||(t[11]=l("span",null,"商品金额",-1)),l("span",null,"¥"+u(d(i).total.toFixed(2)),1)]),t[15]||(t[15]=l("div",{class:"d-flex justify-space-between mb-2"},[l("span",null,"运费"),l("span",{class:"text-success"},"免运费")],-1)),e(j,{class:"my-3"}),l("div",K,[t[12]||(t[12]=l("strong",null,"应付金额",-1)),l("strong",Q,"¥"+u(d(i).total.toFixed(2)),1)]),e(_,{color:"primary",block:"",loading:b.value,onClick:O},{default:a(()=>[e(r,{name:"check",class:"mr-2"}),t[13]||(t[13]=n(" 提交订单 ",-1))]),_:1},8,["loading"]),e(_,{preset:"secondary",block:"",class:"mt-2",onClick:t[3]||(t[3]=s=>d(p).push("/cart"))},{default:a(()=>[e(r,{name:"arrow_back",class:"mr-2"}),t[14]||(t[14]=n(" 返回购物车 ",-1))]),_:1})]),_:1})]),_:1})])]))])}}});export{at as default};
