import{a as w}from"./index-DzZRbFal.js";import{k as M,r as _,G as S,q as u,C as e,L as o,v as i,a4 as c,w as s,F as R,D as I,c as T,t as B,x as v,o as r,n as U}from"./vue-C5tvXR9f.js";import{_ as q}from"./_plugin-vue_export-helper-BREQrZf2.js";const O={class:"hotreload-page"},P={class:"page-header"},h={class:"main-grid"},j={class:"register-form"},A={key:0,class:"empty-state"},J={key:1,class:"flow-list"},K=["onClick"],Q={class:"flow-name"},W={key:0,class:"empty-state"},X={key:1,class:"flow-details"},Y={class:"detail-row"},Z={class:"detail-value"},ll={class:"detail-row"},el={class:"detail-row"},ol={class:"detail-row"},sl={class:"detail-actions"},tl={key:0,class:"event-info"},al={class:"event-properties"},nl={class:"event-usage"},il=M({__name:"HotReload",setup(rl){const C=_([]),V=_(!1),m=_(""),d=_(null),f=_(null),p=_(null),F=async()=>{V.value=!0;try{const t=await w.getRegisteredFlows();C.value=t.Flows||[]}catch(t){console.error("Failed to load flows:",t)}finally{V.value=!1}},N=async t=>{try{d.value=await w.getFlowDetails(t)}catch{d.value=null}},D=async()=>{if(m.value)try{await w.registerFlow(m.value),m.value="",await F()}catch(t){console.error("Failed to register flow:",t)}},E=async t=>{try{f.value=await w.reloadFlow(t),await N(t)}catch(l){console.error("Failed to reload flow:",l)}},$=async t=>{try{await w.unregisterFlow(t),d.value=null,await F()}catch(l){console.error("Failed to unregister flow:",l)}},H=async()=>{try{p.value=await w.getReloadEventInfo()}catch(t){console.error("Failed to load event info:",t)}};return S(()=>{F(),H()}),(t,l)=>{const a=c("va-icon"),y=c("va-button"),g=c("va-card-title"),G=c("va-input"),x=c("va-divider"),k=c("va-card-content"),b=c("va-card"),z=c("va-badge"),L=c("va-alert");return r(),u("div",O,[e("div",P,[e("h1",null,[o(a,{name:"autorenew",color:"primary",size:"large"}),l[3]||(l[3]=i(" Flow 热重载 (Hot Reload) ",-1))]),l[4]||(l[4]=e("p",{class:"page-desc"},"动态注册、版本管理和 Flow 重载演示",-1))]),e("div",h,[o(b,null,{default:s(()=>[o(g,null,{default:s(()=>[o(a,{name:"folder_special",class:"section-icon"}),l[5]||(l[5]=i(" 已注册的 Flows ",-1)),o(y,{size:"small",preset:"secondary",onClick:F,loading:V.value,class:"refresh-btn"},{default:s(()=>[o(a,{name:"refresh"})]),_:1},8,["loading"])]),_:1}),o(k,null,{default:s(()=>[e("div",j,[o(G,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=n=>m.value=n),placeholder:"输入 Flow 名称",size:"small"},null,8,["modelValue"]),o(y,{size:"small",onClick:D,disabled:!m.value},{default:s(()=>[o(a,{name:"add",class:"btn-icon"}),l[6]||(l[6]=i(" 注册 ",-1))]),_:1},8,["disabled"])]),o(x),C.value.length===0?(r(),u("div",A,[o(a,{name:"inbox",size:"2rem",color:"secondary"}),l[7]||(l[7]=e("p",null,"暂无注册的 Flow",-1))])):(r(),u("div",J,[(r(!0),u(R,null,I(C.value,n=>(r(),u("div",{key:n,class:U(["flow-item",{active:d.value?.FlowName===n}]),onClick:dl=>N(n)},[o(a,{name:"schema",class:"flow-icon"}),e("span",Q,v(n),1),o(a,{name:"chevron_right",class:"chevron"})],10,K))),128))]))]),_:1})]),_:1}),o(b,null,{default:s(()=>[o(g,null,{default:s(()=>[o(a,{name:"info",class:"section-icon"}),l[8]||(l[8]=i(" Flow 详情 ",-1))]),_:1}),o(k,null,{default:s(()=>[d.value?(r(),u("div",X,[e("div",Y,[l[10]||(l[10]=e("span",{class:"detail-label"},"名称",-1)),e("span",Z,v(d.value.FlowName),1)]),e("div",ll,[l[11]||(l[11]=e("span",{class:"detail-label"},"版本",-1)),o(z,{text:`v${d.value.Version}`,color:"primary"},null,8,["text"])]),e("div",el,[l[12]||(l[12]=e("span",{class:"detail-label"},"配置类型",-1)),e("code",null,v(d.value.ConfigType),1)]),e("div",ol,[l[13]||(l[13]=e("span",{class:"detail-label"},"状态",-1)),o(z,{text:"已注册",color:"success"})]),o(x),e("div",sl,[o(y,{color:"primary",onClick:l[1]||(l[1]=n=>E(d.value.FlowName))},{default:s(()=>[o(a,{name:"autorenew",class:"btn-icon"}),l[14]||(l[14]=i(" 重载 Flow ",-1))]),_:1}),o(y,{color:"danger",preset:"secondary",onClick:l[2]||(l[2]=n=>$(d.value.FlowName))},{default:s(()=>[o(a,{name:"delete",class:"btn-icon"}),l[15]||(l[15]=i(" 注销 ",-1))]),_:1})]),f.value?(r(),T(L,{key:0,color:"success",class:"reload-result"},{default:s(()=>[l[16]||(l[16]=e("strong",null,"重载成功!",-1)),e("p",null,v(f.value.OldVersion)+" → "+v(f.value.NewVersion),1)]),_:1})):B("",!0)])):(r(),u("div",W,[o(a,{name:"touch_app",size:"2rem",color:"secondary"}),l[9]||(l[9]=e("p",null,"选择一个 Flow 查看详情",-1))]))]),_:1})]),_:1})]),o(b,{class:"event-card"},{default:s(()=>[o(g,null,{default:s(()=>[o(a,{name:"notifications_active",class:"section-icon"}),l[17]||(l[17]=i(" 重载事件 (FlowReloadedEvent) ",-1))]),_:1}),o(k,null,{default:s(()=>[p.value?(r(),u("div",tl,[e("div",al,[l[18]||(l[18]=e("h4",null,"事件属性:",-1)),e("ul",null,[(r(!0),u(R,null,I(p.value.Properties,n=>(r(),u("li",{key:n},v(n),1))),128))])]),e("div",nl,[l[19]||(l[19]=e("h4",null,"使用示例:",-1)),e("pre",null,[e("code",null,v(p.value.Usage),1)])])])):B("",!0)]),_:1})]),_:1}),o(b,null,{default:s(()=>[o(g,null,{default:s(()=>[o(a,{name:"history",class:"section-icon"}),l[20]||(l[20]=i(" 版本管理器 (IFlowVersionManager) ",-1))]),_:1}),o(k,null,{default:s(()=>[...l[21]||(l[21]=[e("div",{class:"version-info"},[e("div",{class:"info-block"},[e("h4",null,"接口方法"),e("ul",null,[e("li",null,[e("code",null,"GetCurrentVersion(flowName)"),i(" - 获取当前版本")]),e("li",null,[e("code",null,"SetVersion(flowName, version)"),i(" - 设置版本")]),e("li",null,[e("code",null,"IncrementVersion(flowName)"),i(" - 版本号 +1")])])]),e("div",{class:"info-block"},[e("h4",null,"使用场景"),e("ul",null,[e("li",null,"在 Flow 执行前检查版本兼容性"),e("li",null,"记录 Flow 配置变更历史"),e("li",null,"支持 Flow 配置回滚")])])],-1)])]),_:1})]),_:1})])}}}),ml=q(il,[["__scopeId","data-v-4807c439"]]);export{ml as default};
