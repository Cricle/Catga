import{a as p}from"./index-Ca5JJS8k.js";import{k as E,r as w,G as I,q as F,L as l,C as d,w as e,a4 as s,v as o,c as B,F as M,D as O,t as U,x as y,o as v,n as j}from"./vue-DxbRKzch.js";import"./index-B9ygI19o.js";const A={class:"row"},J={class:"flex md6 xs12"},K={class:"row mb-3"},P={class:"flex xs8"},Q={class:"flex xs4"},W={key:0,class:"text-center pa-4"},X={class:"flex md6 xs12"},Y={key:0,class:"text-center pa-4"},Z={key:1},ol=E({__name:"HotReload",setup(h){const N=w([]),g=w(!1),f=w(""),i=w(null),c=w(null),x=async()=>{g.value=!0;try{const u=await p.getRegisteredFlows();N.value=u.Flows||[]}catch(u){console.error("Failed to load flows:",u)}finally{g.value=!1}},D=async u=>{try{i.value=await p.getFlowDetails(u)}catch{i.value=null}},G=async()=>{if(f.value)try{await p.registerFlow(f.value),f.value="",await x()}catch(u){console.error("Failed to register flow:",u)}},H=async u=>{try{c.value=await p.reloadFlow(u),await D(u)}catch(t){console.error("Failed to reload flow:",t)}},L=async u=>{try{await p.unregisterFlow(u),i.value=null,c.value=null,await x()}catch(t){console.error("Failed to unregister flow:",t)}};return I(x),(u,t)=>{const n=s("va-icon"),k=s("va-card-title"),b=s("va-card-content"),C=s("va-card"),V=s("va-button"),S=s("va-input"),R=s("va-divider"),a=s("va-list-item-section"),r=s("va-list-item-label"),_=s("va-list-item"),z=s("va-list"),T=s("va-inner-loading"),$=s("va-badge"),q=s("va-alert");return v(),F("div",null,[l(C,{class:"mb-4"},{default:e(()=>[l(k,null,{default:e(()=>[l(n,{name:"autorenew",class:"mr-2"}),t[3]||(t[3]=o(" Flow 热重载 (Hot Reload) ",-1))]),_:1}),l(b,null,{default:e(()=>[...t[4]||(t[4]=[d("p",null,"动态注册、版本管理和 Flow 重载演示",-1)])]),_:1})]),_:1}),d("div",A,[d("div",J,[l(C,{class:"mb-4"},{default:e(()=>[l(k,null,{default:e(()=>[l(n,{name:"folder_special",class:"mr-2"}),t[5]||(t[5]=o(" 已注册的 Flows ",-1)),l(V,{size:"small",preset:"secondary",class:"ml-auto",onClick:x,loading:g.value},{default:e(()=>[l(n,{name:"refresh"})]),_:1},8,["loading"])]),_:1}),l(b,null,{default:e(()=>[d("div",K,[d("div",P,[l(S,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=m=>f.value=m),placeholder:"Flow 名称",size:"small"},null,8,["modelValue"])]),d("div",Q,[l(V,{size:"small",block:"",onClick:G,disabled:!f.value},{default:e(()=>[l(n,{name:"add",class:"mr-1"}),t[6]||(t[6]=o(" 注册 ",-1))]),_:1},8,["disabled"])])]),l(R),l(T,{loading:g.value},{default:e(()=>[N.value.length===0?(v(),F("div",W,[l(n,{name:"inbox",size:"2rem",color:"secondary"}),t[7]||(t[7]=d("p",{class:"mt-2"},"暂无注册的 Flow",-1))])):(v(),B(z,{key:1},{default:e(()=>[(v(!0),F(M,null,O(N.value,m=>(v(),B(_,{key:m,onClick:ll=>D(m),class:j({"va-list-item--active":i.value?.FlowName===m})},{default:e(()=>[l(a,{avatar:""},{default:e(()=>[l(n,{name:"schema",color:"primary"})]),_:1}),l(a,null,{default:e(()=>[l(r,null,{default:e(()=>[o(y(m),1)]),_:2},1024)]),_:2},1024),l(a,{icon:""},{default:e(()=>[l(n,{name:"chevron_right"})]),_:1})]),_:2},1032,["onClick","class"]))),128))]),_:1}))]),_:1},8,["loading"])]),_:1})]),_:1})]),d("div",X,[l(C,{class:"mb-4"},{default:e(()=>[l(k,null,{default:e(()=>[l(n,{name:"info",class:"mr-2"}),t[8]||(t[8]=o(" Flow 详情",-1))]),_:1}),l(b,null,{default:e(()=>[i.value?(v(),F("div",Z,[l(z,null,{default:e(()=>[l(_,null,{default:e(()=>[l(a,null,{default:e(()=>[l(r,{caption:""},{default:e(()=>[...t[10]||(t[10]=[o("名称",-1)])]),_:1})]),_:1}),l(a,null,{default:e(()=>[l(r,null,{default:e(()=>[o(y(i.value.FlowName),1)]),_:1})]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(a,null,{default:e(()=>[l(r,{caption:""},{default:e(()=>[...t[11]||(t[11]=[o("版本",-1)])]),_:1})]),_:1}),l(a,null,{default:e(()=>[l($,{text:`v${i.value.Version}`,color:"primary"},null,8,["text"])]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(a,null,{default:e(()=>[l(r,{caption:""},{default:e(()=>[...t[12]||(t[12]=[o("配置类型",-1)])]),_:1})]),_:1}),l(a,null,{default:e(()=>[d("code",null,y(i.value.ConfigType),1)]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(a,null,{default:e(()=>[l(r,{caption:""},{default:e(()=>[...t[13]||(t[13]=[o("状态",-1)])]),_:1})]),_:1}),l(a,null,{default:e(()=>[l($,{text:"已注册",color:"success"})]),_:1})]),_:1})]),_:1}),l(R,{class:"my-3"}),l(V,{color:"primary",class:"mr-2",onClick:t[1]||(t[1]=m=>H(i.value.FlowName))},{default:e(()=>[l(n,{name:"autorenew",class:"mr-1"}),t[14]||(t[14]=o(" 重载 ",-1))]),_:1}),l(V,{color:"danger",preset:"secondary",onClick:t[2]||(t[2]=m=>L(i.value.FlowName))},{default:e(()=>[l(n,{name:"delete",class:"mr-1"}),t[15]||(t[15]=o(" 注销 ",-1))]),_:1}),c.value?(v(),B(q,{key:0,color:"success",class:"mt-3"},{default:e(()=>[o(" 重载成功! v"+y(c.value.OldVersion)+" → v"+y(c.value.NewVersion),1)]),_:1})):U("",!0)])):(v(),F("div",Y,[l(n,{name:"touch_app",size:"2rem",color:"secondary"}),t[9]||(t[9]=d("p",{class:"mt-2"},"选择一个 Flow 查看详情",-1))]))]),_:1})]),_:1})])]),l(C,{class:"mb-4"},{default:e(()=>[l(k,null,{default:e(()=>[l(n,{name:"history",class:"mr-2"}),t[16]||(t[16]=o(" 版本管理器接口",-1))]),_:1}),l(b,null,{default:e(()=>[l(z,null,{default:e(()=>[l(_,null,{default:e(()=>[l(a,{avatar:""},{default:e(()=>[l(n,{name:"code"})]),_:1}),l(a,null,{default:e(()=>[l(r,null,{default:e(()=>[...t[17]||(t[17]=[d("code",null,"GetCurrentVersion(flowName)",-1)])]),_:1}),l(r,{caption:""},{default:e(()=>[...t[18]||(t[18]=[o("获取当前版本",-1)])]),_:1})]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(a,{avatar:""},{default:e(()=>[l(n,{name:"code"})]),_:1}),l(a,null,{default:e(()=>[l(r,null,{default:e(()=>[...t[19]||(t[19]=[d("code",null,"SetVersion(flowName, version)",-1)])]),_:1}),l(r,{caption:""},{default:e(()=>[...t[20]||(t[20]=[o("设置版本",-1)])]),_:1})]),_:1})]),_:1}),l(_,null,{default:e(()=>[l(a,{avatar:""},{default:e(()=>[l(n,{name:"code"})]),_:1}),l(a,null,{default:e(()=>[l(r,null,{default:e(()=>[...t[21]||(t[21]=[d("code",null,"IncrementVersion(flowName)",-1)])]),_:1}),l(r,{caption:""},{default:e(()=>[...t[22]||(t[22]=[o("版本号 +1",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{ol as default};
