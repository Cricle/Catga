import{k as q,r as g,G as B,q as i,C as t,L as d,w as o,a4 as u,c as w,t as c,v as p,x as n,F as L,D as M,ad as R,ac as S,o as r}from"./vue-DxbRKzch.js";import{u as P}from"./order-Cp0QkwRJ.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Ca5JJS8k.js";import"./index-B9ygI19o.js";const G={class:"my-orders-page"},T={class:"order-id"},U={class:"amount"},Y={class:"action-buttons"},j={key:0,class:"order-detail"},H={class:"detail-row"},J={class:"detail-row"},K={class:"detail-row"},Q={key:0,class:"detail-row"},W={key:1,class:"detail-row"},X={key:2,class:"detail-row"},Z={class:"order-items"},h={class:"item-name"},ee={class:"item-qty"},te={class:"item-price"},ae={class:"order-total"},se={class:"total-amount"},le=q({__name:"MyOrders",setup(oe){R(),S();const m=P(),v=g([]),x=g(!1),s=g(null),_={0:{text:"待支付",color:"warning"},1:{text:"已支付",color:"info"},2:{text:"处理中",color:"primary"},3:{text:"已发货",color:"secondary"},4:{text:"已完成",color:"success"},5:{text:"已取消",color:"danger"}},y=async()=>{x.value=!0;try{v.value=await m.fetchOrders()}finally{x.value=!1}},A=l=>{s.value=l},I=async l=>{await m.payOrder(l,"Alipay",`PAY-${Date.now()}`),await y(),s.value?.orderId===l&&(s.value=v.value.find(e=>e.orderId===l)||null)},N=async l=>{await m.cancelOrder(l,"用户取消"),await y(),s.value?.orderId===l&&(s.value=v.value.find(e=>e.orderId===l)||null)},V=async l=>{await m.deliverOrder(l),await y(),s.value?.orderId===l&&(s.value=v.value.find(e=>e.orderId===l)||null)},f=l=>l?new Date(l).toLocaleString("zh-CN"):"-";return B(()=>{y()}),(l,e)=>{const C=u("va-badge"),k=u("va-button"),z=u("va-data-table"),$=u("va-card-content"),D=u("va-card"),O=u("va-divider"),F=u("va-modal");return r(),i("div",G,[e[14]||(e[14]=t("h1",null,"我的订单",-1)),d(D,null,{default:o(()=>[d($,null,{default:o(()=>[d(z,{items:v.value,columns:[{key:"orderId",label:"订单号",width:"180px"},{key:"totalAmount",label:"金额"},{key:"status",label:"状态"},{key:"createdAt",label:"创建时间"},{key:"actions",label:"操作",width:"200px"}],loading:x.value},{"cell(orderId)":o(({value:a})=>[t("code",T,n(a),1)]),"cell(totalAmount)":o(({value:a})=>[t("span",U,"¥"+n(a?.toFixed(2)||"0.00"),1)]),"cell(status)":o(({value:a})=>[d(C,{text:_[a]?.text||"未知",color:_[a]?.color||"secondary"},null,8,["text","color"])]),"cell(createdAt)":o(({value:a})=>[p(n(f(a)),1)]),"cell(actions)":o(({row:a})=>[t("div",Y,[d(k,{size:"small",preset:"secondary",onClick:b=>A(a)},{default:o(()=>[...e[2]||(e[2]=[p(" 详情 ",-1)])]),_:1},8,["onClick"]),a.status===0?(r(),w(k,{key:0,size:"small",color:"success",onClick:b=>I(a.orderId)},{default:o(()=>[...e[3]||(e[3]=[p(" 支付 ",-1)])]),_:1},8,["onClick"])):c("",!0),a.status===3?(r(),w(k,{key:1,size:"small",color:"primary",onClick:b=>V(a.orderId)},{default:o(()=>[...e[4]||(e[4]=[p(" 确认收货 ",-1)])]),_:1},8,["onClick"])):c("",!0),a.status<3?(r(),w(k,{key:2,size:"small",preset:"secondary",color:"danger",onClick:b=>N(a.orderId)},{default:o(()=>[...e[5]||(e[5]=[p(" 取消 ",-1)])]),_:1},8,["onClick"])):c("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1}),d(F,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),title:"订单详情",size:"large",onOk:e[1]||(e[1]=a=>s.value=null)},{default:o(()=>[s.value?(r(),i("div",j,[t("div",H,[e[6]||(e[6]=t("span",{class:"label"},"订单号:",-1)),t("code",null,n(s.value.orderId),1)]),t("div",J,[e[7]||(e[7]=t("span",{class:"label"},"状态:",-1)),d(C,{text:_[s.value.status]?.text,color:_[s.value.status]?.color},null,8,["text","color"])]),t("div",K,[e[8]||(e[8]=t("span",{class:"label"},"创建时间:",-1)),t("span",null,n(f(s.value.createdAt)),1)]),s.value.paidAt?(r(),i("div",Q,[e[9]||(e[9]=t("span",{class:"label"},"支付时间:",-1)),t("span",null,n(f(s.value.paidAt)),1)])):c("",!0),s.value.shippedAt?(r(),i("div",W,[e[10]||(e[10]=t("span",{class:"label"},"发货时间:",-1)),t("span",null,n(f(s.value.shippedAt)),1)])):c("",!0),s.value.trackingNumber?(r(),i("div",X,[e[11]||(e[11]=t("span",{class:"label"},"物流单号:",-1)),t("code",null,n(s.value.trackingNumber),1)])):c("",!0),d(O),e[13]||(e[13]=t("h4",null,"商品列表",-1)),t("div",Z,[(r(!0),i(L,null,M(s.value.items,a=>(r(),i("div",{key:a.productId,class:"order-item"},[t("span",h,n(a.productName),1),t("span",ee,"x"+n(a.quantity),1),t("span",te,"¥"+n((a.unitPrice*a.quantity).toFixed(2)),1)]))),128))]),d(O),t("div",ae,[e[12]||(e[12]=t("span",null,"订单总额:",-1)),t("span",se,"¥"+n(s.value.totalAmount.toFixed(2)),1)])])):c("",!0)]),_:1},8,["modelValue"])])}}}),ce=E(le,[["__scopeId","data-v-c8b5ec3f"]]);export{ce as default};
