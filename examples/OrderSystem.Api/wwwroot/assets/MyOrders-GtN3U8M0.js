import{u as Y}from"./order-Cp0QkwRJ.js";import{k as H,r as $,G as J,q as C,L as l,c,t as m,w as t,a4 as v,v as s,C as u,F as D,D as q,x as o,o as r}from"./vue-DxbRKzch.js";import"./index-Ca5JJS8k.js";import"./index-B9ygI19o.js";const K={class:"d-flex justify-space-between align-center mb-3"},Q={class:"d-flex justify-space-between align-center"},W={class:"text-secondary"},X={class:"d-flex align-center"},Z={class:"mr-3"},h={class:"va-text-danger va-h6"},ee={class:"d-flex justify-space-between align-center mb-4"},te={key:0,class:"ml-2"},le={key:0,class:"ml-2 text-secondary"},ae={class:"d-flex justify-space-between"},se={class:"va-text-danger va-h5"},de=H({__name:"MyOrders",setup(ne){const O=Y(),y=$([]),w=$(!1),a=$(null),k=$(!1),g={0:{text:"待支付",color:"warning",icon:"schedule"},1:{text:"已支付",color:"info",icon:"paid"},2:{text:"处理中",color:"primary",icon:"inventory"},3:{text:"已发货",color:"secondary",icon:"local_shipping"},4:{text:"已完成",color:"success",icon:"check_circle"},5:{text:"已取消",color:"danger",icon:"cancel"}},A=async()=>{w.value=!0;try{y.value=await O.fetchOrders()}finally{w.value=!1}},S=d=>{a.value=d,k.value=!0},P=async d=>{await O.payOrder(d,"Alipay",`PAY-${Date.now()}`),await A(),a.value?.orderId===d&&(a.value=y.value.find(e=>e.orderId===d)||null)},M=async d=>{await O.cancelOrder(d,"用户取消"),await A(),a.value?.orderId===d&&(a.value=y.value.find(e=>e.orderId===d)||null)},j=async d=>{await O.deliverOrder(d),await A(),a.value?.orderId===d&&(a.value=y.value.find(e=>e.orderId===d)||null)},x=d=>d?new Date(d).toLocaleString("zh-CN"):"-";return J(A),(d,e)=>{const i=v("va-icon"),p=v("va-button"),E=v("va-card-title"),I=v("va-card"),N=v("va-card-content"),B=v("va-chip"),L=v("va-avatar"),_=v("va-list-item-section"),z=v("va-list-item-label"),F=v("va-list-item"),R=v("va-list"),V=v("va-divider"),G=v("va-inner-loading"),b=v("va-timeline-item"),T=v("va-timeline"),U=v("va-modal");return r(),C("div",null,[l(I,{class:"mb-4"},{default:t(()=>[l(E,null,{default:t(()=>[l(i,{name:"receipt_long",class:"mr-2"}),e[5]||(e[5]=s("我的订单 ",-1)),l(p,{size:"small",preset:"secondary",class:"ml-auto",onClick:A,loading:w.value},{default:t(()=>[l(i,{name:"refresh"})]),_:1},8,["loading"])]),_:1})]),_:1}),y.value.length===0&&!w.value?(r(),c(I,{key:0,class:"text-center"},{default:t(()=>[l(N,{class:"pa-6"},{default:t(()=>[l(i,{name:"inbox",size:"4rem",color:"secondary"}),e[7]||(e[7]=u("h3",{class:"va-h5 mt-4"},"暂无订单",-1)),e[8]||(e[8]=u("p",{class:"text-secondary mb-4"},"快去选购商品吧！",-1)),l(p,{onClick:e[0]||(e[0]=n=>d.$router.push("/"))},{default:t(()=>[l(i,{name:"store",class:"mr-2"}),e[6]||(e[6]=s("去购物 ",-1))]),_:1})]),_:1})]),_:1})):m("",!0),l(G,{loading:w.value},{default:t(()=>[(r(!0),C(D,null,q(y.value,n=>(r(),c(I,{key:n.orderId,class:"mb-3"},{default:t(()=>[l(N,null,{default:t(()=>[u("div",K,[u("div",null,[e[9]||(e[9]=u("span",{class:"text-secondary mr-2"},"订单号:",-1)),u("code",null,o(n.orderId),1)]),l(B,{color:g[n.status]?.color,size:"small"},{default:t(()=>[l(i,{name:g[n.status]?.icon,size:"small",class:"mr-1"},null,8,["name"]),s(" "+o(g[n.status]?.text),1)]),_:2},1032,["color"])]),l(R,null,{default:t(()=>[(r(!0),C(D,null,q(n.items?.slice(0,2),f=>(r(),c(F,{key:f.productId},{default:t(()=>[l(_,{avatar:""},{default:t(()=>[l(L,{color:"background-element",size:"small"},{default:t(()=>[l(i,{name:"inventory_2",color:"primary",size:"small"})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(z,null,{default:t(()=>[s(o(f.productName),1)]),_:2},1024),l(z,{caption:""},{default:t(()=>[s("¥"+o(f.unitPrice?.toFixed(2))+" × "+o(f.quantity),1)]),_:2},1024)]),_:2},1024),l(_,{side:""},{default:t(()=>[s(" ¥"+o(((f.unitPrice||0)*(f.quantity||0)).toFixed(2)),1)]),_:2},1024)]),_:2},1024))),128)),(n.items?.length||0)>2?(r(),c(F,{key:0},{default:t(()=>[l(_,null,{default:t(()=>[l(z,{caption:""},{default:t(()=>[s("...还有 "+o((n.items?.length||0)-2)+" 件商品",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)):m("",!0)]),_:2},1024),l(V,{class:"my-3"}),u("div",Q,[u("div",null,[u("span",W,"下单时间: "+o(x(n.createdAt)),1)]),u("div",X,[u("span",Z,[e[10]||(e[10]=s("合计: ",-1)),u("strong",h,"¥"+o(n.totalAmount?.toFixed(2)),1)]),l(p,{size:"small",preset:"secondary",class:"mr-2",onClick:f=>S(n)},{default:t(()=>[l(i,{name:"visibility",class:"mr-1"}),e[11]||(e[11]=s("详情 ",-1))]),_:1},8,["onClick"]),n.status===0?(r(),c(p,{key:0,size:"small",color:"success",class:"mr-2",onClick:f=>P(n.orderId)},{default:t(()=>[l(i,{name:"payment",class:"mr-1"}),e[12]||(e[12]=s("支付 ",-1))]),_:1},8,["onClick"])):m("",!0),n.status===3?(r(),c(p,{key:1,size:"small",color:"primary",class:"mr-2",onClick:f=>j(n.orderId)},{default:t(()=>[l(i,{name:"check",class:"mr-1"}),e[13]||(e[13]=s("确认收货 ",-1))]),_:1},8,["onClick"])):m("",!0),n.status<3?(r(),c(p,{key:2,size:"small",preset:"secondary",color:"danger",onClick:f=>M(n.orderId)},{default:t(()=>[l(i,{name:"close",class:"mr-1"}),e[14]||(e[14]=s("取消 ",-1))]),_:1},8,["onClick"])):m("",!0)])])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["loading"]),l(U,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=n=>k.value=n),title:"订单详情",size:"large","hide-default-actions":""},{footer:t(()=>[a.value?.status===0?(r(),c(p,{key:0,color:"success",class:"mr-2",onClick:e[1]||(e[1]=n=>{P(a.value.orderId),k.value=!1})},{default:t(()=>[l(i,{name:"payment",class:"mr-1"}),e[26]||(e[26]=s("立即支付 ",-1))]),_:1})):m("",!0),a.value?.status===3?(r(),c(p,{key:1,color:"primary",class:"mr-2",onClick:e[2]||(e[2]=n=>{j(a.value.orderId),k.value=!1})},{default:t(()=>[l(i,{name:"check",class:"mr-1"}),e[27]||(e[27]=s("确认收货 ",-1))]),_:1})):m("",!0),l(p,{preset:"secondary",onClick:e[3]||(e[3]=n=>k.value=!1)},{default:t(()=>[...e[28]||(e[28]=[s("关闭",-1)])]),_:1})]),default:t(()=>[a.value?(r(),c(I,{key:0,flat:""},{default:t(()=>[l(N,null,{default:t(()=>[u("div",ee,[u("div",null,[e[15]||(e[15]=u("span",{class:"text-secondary"},"订单号: ",-1)),u("code",null,o(a.value.orderId),1)]),l(B,{color:g[a.value.status]?.color},{default:t(()=>[l(i,{name:g[a.value.status]?.icon,size:"small",class:"mr-1"},null,8,["name"]),s(" "+o(g[a.value.status]?.text),1)]),_:1},8,["color"])]),l(T,null,{default:t(()=>[a.value.createdAt?(r(),c(b,{key:0,color:"success"},{before:t(()=>[s(o(x(a.value.createdAt)),1)]),default:t(()=>[l(i,{name:"add_shopping_cart",class:"mr-2"}),e[16]||(e[16]=s("订单创建 ",-1))]),_:1})):m("",!0),a.value.paidAt?(r(),c(b,{key:1,color:"info"},{before:t(()=>[s(o(x(a.value.paidAt)),1)]),default:t(()=>[l(i,{name:"paid",class:"mr-2"}),e[17]||(e[17]=s("支付成功 ",-1))]),_:1})):m("",!0),a.value.status>=2&&a.value.status!==5?(r(),c(b,{key:2,color:"primary"},{before:t(()=>[...e[18]||(e[18]=[s("处理中",-1)])]),default:t(()=>[l(i,{name:"inventory",class:"mr-2"}),e[19]||(e[19]=s("商家处理 ",-1))]),_:1})):m("",!0),a.value.shippedAt?(r(),c(b,{key:3,color:"secondary"},{before:t(()=>[s(o(x(a.value.shippedAt)),1)]),default:t(()=>[l(i,{name:"local_shipping",class:"mr-2"}),e[21]||(e[21]=s("已发货 ",-1)),a.value.trackingNumber?(r(),C("span",te,[e[20]||(e[20]=s(" 物流单号: ",-1)),u("code",null,o(a.value.trackingNumber),1)])):m("",!0)]),_:1})):m("",!0),a.value.deliveredAt?(r(),c(b,{key:4,color:"success"},{before:t(()=>[s(o(x(a.value.deliveredAt)),1)]),default:t(()=>[l(i,{name:"check_circle",class:"mr-2"}),e[22]||(e[22]=s("已完成 ",-1))]),_:1})):m("",!0),a.value.cancelledAt?(r(),c(b,{key:5,color:"danger"},{before:t(()=>[s(o(x(a.value.cancelledAt)),1)]),default:t(()=>[l(i,{name:"cancel",class:"mr-2"}),e[23]||(e[23]=s("已取消 ",-1)),a.value.cancellationReason?(r(),C("span",le," 原因: "+o(a.value.cancellationReason),1)):m("",!0)]),_:1})):m("",!0)]),_:1}),l(V,{class:"my-4"}),e[25]||(e[25]=u("h4",{class:"va-h6 mb-3"},"商品列表",-1)),l(R,null,{default:t(()=>[(r(!0),C(D,null,q(a.value.items,n=>(r(),c(F,{key:n.productId},{default:t(()=>[l(_,{avatar:""},{default:t(()=>[l(L,{color:"background-element"},{default:t(()=>[l(i,{name:"inventory_2",color:"primary"})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(z,null,{default:t(()=>[s(o(n.productName),1)]),_:2},1024),l(z,{caption:""},{default:t(()=>[s("¥"+o(n.unitPrice?.toFixed(2))+" × "+o(n.quantity),1)]),_:2},1024)]),_:2},1024),l(_,{side:""},{default:t(()=>[u("strong",null,"¥"+o(((n.unitPrice||0)*(n.quantity||0)).toFixed(2)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(V,{class:"my-4"}),u("div",ae,[e[24]||(e[24]=u("span",{class:"va-h6"},"订单总额",-1)),u("span",se,"¥"+o(a.value.totalAmount?.toFixed(2)),1)])]),_:1})]),_:1})):m("",!0)]),_:1},8,["modelValue"])])}}});export{de as default};
