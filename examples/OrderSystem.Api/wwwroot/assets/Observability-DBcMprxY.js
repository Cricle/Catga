import{a as S}from"./index-Ca5JJS8k.js";import{k as I,r as w,G as j,q as i,L as l,C as o,w as a,a4 as r,v as n,t as T,F as _,D as v,c as d,x as c,o as s}from"./vue-C5tvXR9f.js";import"./index-B9ygI19o.js";const q={class:"row"},J={class:"flex md6 xs12"},R={key:0},A={class:"flex md6 xs12"},K={key:0},P={class:"row"},Q={class:"flex md4 xs12"},W={class:"flex md4 xs12"},X={class:"flex md4 xs12"},Y={class:"ma-0"},el=I({__name:"Observability",setup(Z){const u=w(null),V=w(!1),F=w(null),k=w("OrderFlow"),C=w(150),D=w("Connection timeout"),G=async()=>{V.value=!0;try{u.value=await S.getObservabilityMetrics()}catch(f){console.error("Failed to load metrics info:",f)}finally{V.value=!1}},B=async()=>{try{F.value=await S.recordFlowDemo(k.value,C.value)}catch(f){console.error("Failed to record flow:",f)}},L=async()=>{try{F.value=await S.recordFailureDemo(k.value,D.value)}catch(f){console.error("Failed to record failure:",f)}};return j(G),(f,e)=>{const m=r("va-icon"),p=r("va-card-title"),b=r("va-card-content"),g=r("va-card"),y=r("va-chip"),U=r("va-inner-loading"),M=r("va-input"),z=r("va-button"),H=r("va-alert"),x=r("va-list-item-section"),N=r("va-list-item-label"),O=r("va-list-item"),E=r("va-list");return s(),i("div",null,[l(g,{class:"mb-4"},{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"monitoring",class:"mr-2"}),e[3]||(e[3]=n(" 可观测性 (Observability) ",-1))]),_:1}),l(b,null,{default:a(()=>[...e[4]||(e[4]=[o("p",null,"Flow DSL 的指标、追踪和日志集成演示",-1)])]),_:1})]),_:1}),o("div",q,[o("div",J,[l(g,{class:"mb-4"},{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"analytics",class:"mr-2"}),e[5]||(e[5]=n(" 可用指标",-1))]),_:1}),l(b,null,{default:a(()=>[l(U,{loading:V.value},{default:a(()=>[u.value?.FlowMetrics?(s(),i("div",R,[e[6]||(e[6]=o("h4",{class:"mb-2"},"计数器 (Counters)",-1)),(s(!0),i(_,null,v(u.value.FlowMetrics.Counters,t=>(s(),d(y,{key:t,size:"small",color:"primary",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128)),e[7]||(e[7]=o("h4",{class:"mt-3 mb-2"},"直方图 (Histograms)",-1)),(s(!0),i(_,null,v(u.value.FlowMetrics.Histograms,t=>(s(),d(y,{key:t,size:"small",color:"success",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128)),e[8]||(e[8]=o("h4",{class:"mt-3 mb-2"},"仪表 (Gauges)",-1)),(s(!0),i(_,null,v(u.value.FlowMetrics.Gauges,t=>(s(),d(y,{key:t,size:"small",color:"warning",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128))])):T("",!0)]),_:1},8,["loading"])]),_:1})]),_:1})]),o("div",A,[l(g,{class:"mb-4"},{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"account_tree",class:"mr-2"}),e[9]||(e[9]=n(" 追踪标签",-1))]),_:1}),l(b,null,{default:a(()=>[u.value?.TracingTags?(s(),i("div",K,[e[10]||(e[10]=o("h4",{class:"mb-2"},"Flow 标签",-1)),(s(!0),i(_,null,v(u.value.TracingTags.FlowTags,t=>(s(),d(y,{key:t,size:"small",outline:"",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128)),e[11]||(e[11]=o("h4",{class:"mt-3 mb-2"},"Step 标签",-1)),(s(!0),i(_,null,v(u.value.TracingTags.StepTags,t=>(s(),d(y,{key:t,size:"small",outline:"",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128)),e[12]||(e[12]=o("h4",{class:"mt-3 mb-2"},"错误标签",-1)),(s(!0),i(_,null,v(u.value.TracingTags.ErrorTags,t=>(s(),d(y,{key:t,size:"small",color:"danger",outline:"",class:"mr-1 mb-1"},{default:a(()=>[n(c(t),1)]),_:2},1024))),128))])):T("",!0)]),_:1})]),_:1})])]),l(g,{class:"mb-4"},{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"science",class:"mr-2"}),e[13]||(e[13]=n(" 实时演示",-1))]),_:1}),l(b,null,{default:a(()=>[o("div",P,[o("div",Q,[l(M,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),label:"Flow 名称",class:"mb-3"},null,8,["modelValue"])]),o("div",W,[l(M,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=t=>C.value=t),modelModifiers:{number:!0},label:"执行时长 (ms)",type:"number",class:"mb-3"},null,8,["modelValue"])]),o("div",X,[l(M,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=t=>D.value=t),label:"错误信息",class:"mb-3"},null,8,["modelValue"])])]),l(z,{color:"success",class:"mr-2",onClick:B},{default:a(()=>[l(m,{name:"check_circle",class:"mr-1"}),e[14]||(e[14]=n(" 记录成功 ",-1))]),_:1}),l(z,{color:"danger",onClick:L},{default:a(()=>[l(m,{name:"error",class:"mr-1"}),e[15]||(e[15]=n(" 记录失败 ",-1))]),_:1}),F.value?(s(),d(H,{key:0,color:"info",class:"mt-3"},{default:a(()=>[o("pre",Y,c(JSON.stringify(F.value,null,2)),1)]),_:1})):T("",!0)]),_:1})]),_:1}),l(g,{class:"mb-4"},{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"timeline",class:"mr-2"}),e[16]||(e[16]=n(" 追踪事件",-1))]),_:1}),l(b,null,{default:a(()=>[u.value?.TracingEvents?(s(),d(E,{key:0},{default:a(()=>[(s(!0),i(_,null,v(u.value.TracingEvents,t=>(s(),d(O,{key:t},{default:a(()=>[l(x,{avatar:""},{default:a(()=>[l(m,{name:t.includes("failed")?"error":"check_circle",color:t.includes("failed")?"danger":"success"},null,8,["name","color"])]),_:2},1024),l(x,null,{default:a(()=>[l(N,null,{default:a(()=>[n(c(t),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):T("",!0)]),_:1})]),_:1}),l(g,null,{default:a(()=>[l(p,null,{default:a(()=>[l(m,{name:"dashboard",class:"mr-2"}),e[17]||(e[17]=n(" Grafana 仪表盘",-1))]),_:1}),l(b,null,{default:a(()=>[e[18]||(e[18]=o("p",null,[o("strong",null,"位置:"),n(),o("code",null,"src/Catga/Observability/GrafanaDashboard.json")],-1)),l(E,null,{default:a(()=>[(s(),i(_,null,v(["Flow执行概览","活跃Flow数量","成功率","执行时长分布","Step分析","Top Flows","最慢Steps"],t=>l(O,{key:t},{default:a(()=>[l(x,{avatar:""},{default:a(()=>[l(m,{name:"bar_chart"})]),_:1}),l(x,null,{default:a(()=>[l(N,null,{default:a(()=>[n(c(t),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})]),_:1})])}}});export{el as default};
