import{u as Q}from"./order-BrofaGUY.js";import{k as W,r as u,E as X,G as Y,q as p,C as t,L as a,a4 as c,w as s,c as D,t as m,v,x as d,F as Z,D as ee,o as i}from"./vue-C5tvXR9f.js";import{_ as le}from"./_plugin-vue_export-helper-BREQrZf2.js";import"./index-DzZRbFal.js";const te={class:"admin-orders"},ae={class:"page-header"},se={class:"header-actions"},oe={class:"order-id"},ne={class:"customer-id"},de={class:"amount"},ie={class:"action-buttons"},re={key:0,class:"order-detail"},ue={class:"detail-section"},ce={class:"detail-grid"},ve={class:"detail-item"},me={class:"detail-item"},pe={class:"detail-item"},_e={class:"detail-item"},fe={class:"amount"},ye={class:"detail-section"},ke={class:"timeline"},be={class:"timeline-item"},xe={key:0,class:"timeline-item"},ge={key:1,class:"timeline-item"},Ce={key:2,class:"timeline-item"},Ve={key:3,class:"timeline-item"},Oe={class:"detail-section"},we={class:"items-list"},Ae={class:"item-name"},Ie={class:"item-qty"},De={class:"item-price"},he={class:"item-subtotal"},ze=W({__name:"Orders",setup(Fe){const k=Q(),h=u([]),g=u(!1),n=u(null),C=u(null),$=[{value:null,label:"全部"},{value:0,label:"待支付"},{value:1,label:"已支付"},{value:2,label:"处理中"},{value:3,label:"已发货"},{value:4,label:"已完成"},{value:5,label:"已取消"}],V={0:{text:"待支付",color:"warning"},1:{text:"已支付",color:"info"},2:{text:"处理中",color:"primary"},3:{text:"已发货",color:"secondary"},4:{text:"已完成",color:"success"},5:{text:"已取消",color:"danger"}},_=async()=>{g.value=!0;try{h.value=await k.fetchOrders(100,C.value??void 0)}finally{g.value=!1}};X(C,()=>_());const U=async o=>{await k.processOrder(o),await _(),O(o)},q=async(o,e)=>{await k.shipOrder(o,e),await _(),O(o)},B=async o=>{await k.deliverOrder(o),await _(),O(o)},L=async(o,e)=>{await k.cancelOrder(o,e),await _(),O(o)},O=o=>{n.value?.orderId===o&&(n.value=h.value.find(e=>e.orderId===o)||null)},b=u(!1),F=u(""),w=u(""),E=o=>{F.value=o,w.value="SF"+Date.now(),b.value=!0},P=async()=>{await q(F.value,w.value),b.value=!1},x=u(!1),S=u(""),A=u(""),G=o=>{S.value=o,A.value="",x.value=!0},M=async()=>{await L(S.value,A.value||"管理员取消"),x.value=!1},f=o=>o?new Date(o).toLocaleString("zh-CN"):"-";return Y(()=>_()),(o,e)=>{const R=c("va-select"),y=c("va-icon"),r=c("va-button"),N=c("va-badge"),T=c("va-data-table"),j=c("va-card-content"),H=c("va-card"),z=c("va-modal"),J=c("va-input"),K=c("va-textarea");return i(),p("div",te,[t("div",ae,[e[8]||(e[8]=t("h1",null,"订单管理",-1)),t("div",se,[a(R,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),options:$,placeholder:"筛选状态",style:{width:"150px"},clearable:""},null,8,["modelValue"]),a(r,{preset:"secondary",onClick:_,loading:g.value},{default:s(()=>[a(y,{name:"refresh"})]),_:1},8,["loading"])])]),a(H,null,{default:s(()=>[a(j,null,{default:s(()=>[a(T,{items:h.value,columns:[{key:"orderId",label:"订单号",width:"180px"},{key:"customerId",label:"客户ID",width:"150px"},{key:"totalAmount",label:"金额"},{key:"status",label:"状态"},{key:"createdAt",label:"创建时间"},{key:"actions",label:"操作",width:"280px"}],loading:g.value},{"cell(orderId)":s(({value:l})=>[t("code",oe,d(l),1)]),"cell(customerId)":s(({value:l})=>[t("code",ne,d(l),1)]),"cell(totalAmount)":s(({value:l})=>[t("span",de,"¥"+d(l?.toFixed(2)||"0.00"),1)]),"cell(status)":s(({value:l})=>[a(N,{text:V[l]?.text||"未知",color:V[l]?.color||"secondary"},null,8,["text","color"])]),"cell(createdAt)":s(({value:l})=>[v(d(f(l)),1)]),"cell(actions)":s(({row:l})=>[t("div",ie,[a(r,{size:"small",preset:"secondary",onClick:I=>n.value=l},{default:s(()=>[...e[9]||(e[9]=[v(" 详情 ",-1)])]),_:1},8,["onClick"]),l.status===1?(i(),D(r,{key:0,size:"small",color:"primary",onClick:I=>U(l.orderId)},{default:s(()=>[...e[10]||(e[10]=[v(" 处理 ",-1)])]),_:1},8,["onClick"])):m("",!0),l.status===2?(i(),D(r,{key:1,size:"small",color:"info",onClick:I=>E(l.orderId)},{default:s(()=>[...e[11]||(e[11]=[v(" 发货 ",-1)])]),_:1},8,["onClick"])):m("",!0),l.status===3?(i(),D(r,{key:2,size:"small",color:"success",onClick:I=>B(l.orderId)},{default:s(()=>[...e[12]||(e[12]=[v(" 确认送达 ",-1)])]),_:1},8,["onClick"])):m("",!0),l.status<4?(i(),D(r,{key:3,size:"small",preset:"secondary",color:"danger",onClick:I=>G(l.orderId)},{default:s(()=>[...e[13]||(e[13]=[v(" 取消 ",-1)])]),_:1},8,["onClick"])):m("",!0)])]),_:1},8,["items","loading"])]),_:1})]),_:1}),a(z,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),title:"订单详情",size:"large"},{default:s(()=>[n.value?(i(),p("div",re,[t("div",ue,[e[18]||(e[18]=t("h4",null,"基本信息",-1)),t("div",ce,[t("div",ve,[e[14]||(e[14]=t("span",{class:"label"},"订单号",-1)),t("code",null,d(n.value.orderId),1)]),t("div",me,[e[15]||(e[15]=t("span",{class:"label"},"客户ID",-1)),t("code",null,d(n.value.customerId),1)]),t("div",pe,[e[16]||(e[16]=t("span",{class:"label"},"状态",-1)),a(N,{text:V[n.value.status]?.text,color:V[n.value.status]?.color},null,8,["text","color"])]),t("div",_e,[e[17]||(e[17]=t("span",{class:"label"},"总金额",-1)),t("span",fe,"¥"+d(n.value.totalAmount.toFixed(2)),1)])])]),t("div",ye,[e[19]||(e[19]=t("h4",null,"时间线",-1)),t("div",ke,[t("div",be,[a(y,{name:"add_circle",color:"primary"}),t("span",null,"创建: "+d(f(n.value.createdAt)),1)]),n.value.paidAt?(i(),p("div",xe,[a(y,{name:"payment",color:"success"}),t("span",null,"支付: "+d(f(n.value.paidAt)),1)])):m("",!0),n.value.shippedAt?(i(),p("div",ge,[a(y,{name:"local_shipping",color:"info"}),t("span",null,"发货: "+d(f(n.value.shippedAt)),1)])):m("",!0),n.value.deliveredAt?(i(),p("div",Ce,[a(y,{name:"check_circle",color:"success"}),t("span",null,"送达: "+d(f(n.value.deliveredAt)),1)])):m("",!0),n.value.cancelledAt?(i(),p("div",Ve,[a(y,{name:"cancel",color:"danger"}),t("span",null,"取消: "+d(f(n.value.cancelledAt)),1)])):m("",!0)])]),t("div",Oe,[e[20]||(e[20]=t("h4",null,"商品列表",-1)),t("div",we,[(i(!0),p(Z,null,ee(n.value.items,l=>(i(),p("div",{key:l.productId,class:"item-row"},[t("span",Ae,d(l.productName),1),t("span",Ie,"x"+d(l.quantity),1),t("span",De,"¥"+d(l.unitPrice.toFixed(2)),1),t("span",he,"¥"+d((l.unitPrice*l.quantity).toFixed(2)),1)]))),128))])])])):m("",!0)]),_:1},8,["modelValue"]),a(z,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=l=>b.value=l),title:"发货",size:"small"},{footer:s(()=>[a(r,{preset:"secondary",onClick:e[3]||(e[3]=l=>b.value=!1)},{default:s(()=>[...e[21]||(e[21]=[v("取消",-1)])]),_:1}),a(r,{color:"primary",onClick:P},{default:s(()=>[...e[22]||(e[22]=[v("确认发货",-1)])]),_:1})]),default:s(()=>[a(J,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),label:"物流单号",placeholder:"请输入物流单号"},null,8,["modelValue"])]),_:1},8,["modelValue"]),a(z,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=l=>x.value=l),title:"取消订单",size:"small"},{footer:s(()=>[a(r,{preset:"secondary",onClick:e[6]||(e[6]=l=>x.value=!1)},{default:s(()=>[...e[23]||(e[23]=[v("返回",-1)])]),_:1}),a(r,{color:"danger",onClick:M},{default:s(()=>[...e[24]||(e[24]=[v("确认取消",-1)])]),_:1})]),default:s(()=>[a(K,{modelValue:A.value,"onUpdate:modelValue":e[5]||(e[5]=l=>A.value=l),label:"取消原因",placeholder:"请输入取消原因（可选）"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),qe=le(ze,[["__scopeId","data-v-5270e1e8"]]);export{qe as default};
