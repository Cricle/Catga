import{a as g}from"./index-DzZRbFal.js";import{k as M,r as v,G as O,q as d,C as s,L as e,v as _,a4 as m,w as a,x as c,F as D,D as T,t as N,o as i}from"./vue-C5tvXR9f.js";import{_ as q}from"./_plugin-vue_export-helper-BREQrZf2.js";const G={class:"readmodelsync-page"},P={class:"page-header"},Q={class:"status-grid"},$={class:"status-header"},j={class:"status-info"},H={class:"status-value"},J={class:"status-header"},K={class:"status-info"},W={class:"status-value"},X={class:"status-header"},Y={class:"status-info"},Z={class:"status-value"},ee={class:"main-grid"},se={class:"track-form"},te={key:0,class:"empty-state"},ae={key:1,class:"changes-list"},le={class:"change-info"},ne={class:"change-entity"},oe={class:"change-id"},ce={class:"change-actions"},de={class:"change-time"},ie={key:0,class:"strategies-grid"},ue={class:"strategy-header"},re={class:"strategy-desc"},ve={class:"strategy-usecase"},_e={key:0,class:"code-examples"},me={class:"code-block"},pe={class:"code-block"},ye={class:"code-block"},ge=M({__name:"ReadModelSync",setup(fe){const f=v(null),S=v([]),p=v(null),b=v(!1),w=v(!1),V=v("Order"),y=v(""),x=v(0),F=[{value:0,text:"Created (创建)"},{value:1,text:"Updated (更新)"},{value:2,text:"Deleted (删除)"}],h=async()=>{b.value=!0;try{f.value=await g.getSyncStatus();const n=await g.getPendingChanges();S.value=n.Changes||[]}catch(n){console.error("Failed to load sync status:",n)}finally{b.value=!1}},U=async()=>{try{p.value=await g.getSyncStrategies()}catch(n){console.error("Failed to load strategies:",n)}},B=async()=>{w.value=!0;try{const n=await g.triggerSync();f.value={LastSyncTime:n.SyncedAt,Status:"Active"},await h()}catch(n){console.error("Failed to sync:",n)}finally{w.value=!1}},I=async()=>{y.value||(y.value="ORD-"+Date.now().toString(36).toUpperCase());try{await g.trackChange(V.value,y.value,x.value),y.value="",await h()}catch(n){console.error("Failed to track change:",n)}},A=async n=>{try{await g.markChangesSynced(n),await h()}catch(t){console.error("Failed to mark synced:",t)}},R=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return O(()=>{h(),U()}),(n,t)=>{const o=m("va-icon"),u=m("va-card-content"),r=m("va-card"),k=m("va-button"),C=m("va-card-title"),z=m("va-input"),E=m("va-select"),L=m("va-badge");return i(),d("div",G,[s("div",P,[s("h1",null,[e(o,{name:"sync",color:"primary",size:"large"}),t[3]||(t[3]=_(" 读模型同步 (Read Model Sync) ",-1))]),t[4]||(t[4]=s("p",{class:"page-desc"},"CQRS 读模型同步策略和变更追踪演示",-1))]),s("div",Q,[e(r,{class:"status-card"},{default:a(()=>[e(u,null,{default:a(()=>[s("div",$,[e(o,{name:"sync_alt",size:"2rem",color:f.value?.Status==="Active"?"success":"warning"},null,8,["color"]),s("div",j,[t[5]||(t[5]=s("span",{class:"status-label"},"同步状态",-1)),s("span",H,c(f.value?.Status||"未知"),1)])])]),_:1})]),_:1}),e(r,{class:"status-card"},{default:a(()=>[e(u,null,{default:a(()=>[s("div",J,[e(o,{name:"schedule",size:"2rem",color:"primary"}),s("div",K,[t[6]||(t[6]=s("span",{class:"status-label"},"上次同步时间",-1)),s("span",W,c(R(f.value?.LastSyncTime)),1)])])]),_:1})]),_:1}),e(r,{class:"status-card"},{default:a(()=>[e(u,null,{default:a(()=>[s("div",X,[e(o,{name:"pending_actions",size:"2rem",color:"warning"}),s("div",Y,[t[7]||(t[7]=s("span",{class:"status-label"},"待同步变更",-1)),s("span",Z,c(S.value.length),1)])])]),_:1})]),_:1}),e(r,{class:"action-card"},{default:a(()=>[e(u,null,{default:a(()=>[e(k,{color:"primary",block:"",onClick:B,loading:w.value},{default:a(()=>[e(o,{name:"sync",class:"btn-icon"}),t[8]||(t[8]=_(" 立即同步 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})]),s("div",ee,[e(r,null,{default:a(()=>[e(C,null,{default:a(()=>[e(o,{name:"add_circle",class:"section-icon"}),t[9]||(t[9]=_(" 追踪变更演示 ",-1))]),_:1}),e(u,null,{default:a(()=>[s("div",se,[e(z,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=l=>V.value=l),label:"实体类型",placeholder:"Order"},null,8,["modelValue"]),e(z,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=l=>y.value=l),label:"实体 ID",placeholder:"自动生成"},null,8,["modelValue"]),e(E,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=l=>x.value=l),label:"变更类型",options:F},null,8,["modelValue"])]),e(k,{color:"success",onClick:I,class:"track-btn"},{default:a(()=>[e(o,{name:"add",class:"btn-icon"}),t[10]||(t[10]=_(" 追踪变更 ",-1))]),_:1})]),_:1})]),_:1}),e(r,null,{default:a(()=>[e(C,null,{default:a(()=>[e(o,{name:"list",class:"section-icon"}),t[11]||(t[11]=_(" 待同步变更 ",-1)),e(k,{size:"small",preset:"secondary",onClick:h,loading:b.value,class:"refresh-btn"},{default:a(()=>[e(o,{name:"refresh"})]),_:1},8,["loading"])]),_:1}),e(u,null,{default:a(()=>[S.value.length===0?(i(),d("div",te,[e(o,{name:"check_circle",size:"2rem",color:"success"}),t[12]||(t[12]=s("p",null,"所有变更已同步",-1))])):(i(),d("div",ae,[(i(!0),d(D,null,T(S.value,l=>(i(),d("div",{key:l.Id,class:"change-item"},[s("div",le,[e(L,{text:["Created","Updated","Deleted"][l.Type],color:["success","primary","danger"][l.Type],size:"small"},null,8,["text","color"]),s("span",ne,c(l.EntityType),1),s("code",oe,c(l.EntityId),1)]),s("div",ce,[s("span",de,c(R(l.Timestamp)),1),e(k,{size:"small",preset:"secondary",onClick:he=>A([l.Id])},{default:a(()=>[e(o,{name:"check"})]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),_:1})]),e(r,null,{default:a(()=>[e(C,null,{default:a(()=>[e(o,{name:"settings_suggest",class:"section-icon"}),t[13]||(t[13]=_(" 同步策略 (Sync Strategies) ",-1))]),_:1}),e(u,null,{default:a(()=>[p.value?.Available?(i(),d("div",ie,[(i(!0),d(D,null,T(p.value.Available,l=>(i(),d("div",{key:l.Name,class:"strategy-card"},[s("div",ue,[e(o,{name:l.Name==="Realtime"?"bolt":l.Name==="Batch"?"layers":"schedule",size:"1.5rem",color:"primary"},null,8,["name"]),s("h4",null,c(l.Name),1)]),s("p",re,c(l.Description),1),s("div",ve,[t[14]||(t[14]=s("strong",null,"适用场景:",-1)),_(" "+c(l.UseCase),1)])]))),128))])):N("",!0)]),_:1})]),_:1}),e(r,null,{default:a(()=>[e(C,null,{default:a(()=>[e(o,{name:"code",class:"section-icon"}),t[15]||(t[15]=_(" 注册示例 ",-1))]),_:1}),e(u,null,{default:a(()=>[p.value?.Registration?(i(),d("div",_e,[s("div",me,[t[16]||(t[16]=s("h4",null,"Realtime (实时)",-1)),s("pre",null,[s("code",null,c(p.value.Registration.Realtime),1)])]),s("div",pe,[t[17]||(t[17]=s("h4",null,"Batch (批处理)",-1)),s("pre",null,[s("code",null,c(p.value.Registration.Batch),1)])]),s("div",ye,[t[18]||(t[18]=s("h4",null,"Scheduled (定时)",-1)),s("pre",null,[s("code",null,c(p.value.Registration.Scheduled),1)])])])):N("",!0)]),_:1})]),_:1})])}}}),be=q(ge,[["__scopeId","data-v-095722a5"]]);export{be as default};
