import{a as g}from"./index-Ca5JJS8k.js";import{k as j,r as _,G as H,q as f,L as e,C as a,w as l,a4 as d,v as c,x as u,c as B,F,D as U,t as E,o as m}from"./vue-C5tvXR9f.js";import"./index-B9ygI19o.js";const J={class:"row mb-4"},K={class:"flex md3 xs6"},W={class:"mb-0 mt-2"},X={class:"flex md3 xs6"},Y={class:"mb-0 mt-2"},Z={class:"flex md3 xs6"},ee={class:"mb-0 mt-2"},le={class:"flex md3 xs6"},te={class:"row"},ae={class:"flex md6 xs12"},se={class:"flex md6 xs12"},ne={key:0,class:"text-center pa-4"},oe={key:0,class:"row"},de={class:"d-flex align-center mb-2"},ce={class:"mb-2"},ue={class:"text-secondary"},ie={key:0},pe=j({__name:"ReadModelSync",setup(re){const x=_(null),k=_([]),v=_(null),C=_(!1),w=_(!1),V=_("Order"),p=_(""),R=_(0),I=[{value:0,text:"Created"},{value:1,text:"Updated"},{value:2,text:"Deleted"}],y=async()=>{C.value=!0;try{x.value=await g.getSyncStatus();const n=await g.getPendingChanges();k.value=n.Changes||[]}catch(n){console.error("Failed to load sync status:",n)}finally{C.value=!1}},L=async()=>{try{v.value=await g.getSyncStrategies()}catch(n){console.error("Failed to load strategies:",n)}},A=async()=>{w.value=!0;try{await g.triggerSync(),await y()}catch(n){console.error("Failed to sync:",n)}finally{w.value=!1}},M=async()=>{p.value||(p.value="ORD-"+Date.now().toString(36).toUpperCase());try{await g.trackChange(V.value,p.value,R.value),p.value="",await y()}catch(n){console.error("Failed to track change:",n)}},O=async n=>{try{await g.markChangesSynced(n),await y()}catch(t){console.error("Failed to mark synced:",t)}},N=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return H(()=>{y(),L()}),(n,t)=>{const o=d("va-icon"),b=d("va-card-title"),i=d("va-card-content"),r=d("va-card"),S=d("va-button"),T=d("va-input"),q=d("va-select"),G=d("va-badge"),h=d("va-list-item-section"),z=d("va-list-item-label"),P=d("va-list-item"),Q=d("va-list"),$=d("va-inner-loading"),D=d("va-code-block");return m(),f("div",null,[e(r,{class:"mb-4"},{default:l(()=>[e(b,null,{default:l(()=>[e(o,{name:"sync",class:"mr-2"}),t[3]||(t[3]=c(" 读模型同步 (Read Model Sync) ",-1))]),_:1}),e(i,null,{default:l(()=>[...t[4]||(t[4]=[a("p",null,"CQRS 读模型同步策略和变更追踪演示",-1)])]),_:1})]),_:1}),a("div",J,[a("div",K,[e(r,null,{default:l(()=>[e(i,{class:"text-center"},{default:l(()=>[e(o,{name:"sync_alt",size:"2rem",color:x.value?.Status==="Active"?"success":"warning"},null,8,["color"]),a("p",W,[a("strong",null,u(x.value?.Status||"未知"),1)]),t[5]||(t[5]=a("small",null,"同步状态",-1))]),_:1})]),_:1})]),a("div",X,[e(r,null,{default:l(()=>[e(i,{class:"text-center"},{default:l(()=>[e(o,{name:"schedule",size:"2rem",color:"primary"}),a("p",Y,[a("strong",null,u(N(x.value?.LastSyncTime)),1)]),t[6]||(t[6]=a("small",null,"上次同步",-1))]),_:1})]),_:1})]),a("div",Z,[e(r,null,{default:l(()=>[e(i,{class:"text-center"},{default:l(()=>[e(o,{name:"pending_actions",size:"2rem",color:"warning"}),a("p",ee,[a("strong",null,u(k.value.length),1)]),t[7]||(t[7]=a("small",null,"待同步变更",-1))]),_:1})]),_:1})]),a("div",le,[e(r,null,{default:l(()=>[e(i,{class:"text-center"},{default:l(()=>[e(S,{color:"primary",onClick:A,loading:w.value},{default:l(()=>[e(o,{name:"sync",class:"mr-1"}),t[8]||(t[8]=c(" 立即同步 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1})])]),a("div",te,[a("div",ae,[e(r,{class:"mb-4"},{default:l(()=>[e(b,null,{default:l(()=>[e(o,{name:"add_circle",class:"mr-2"}),t[9]||(t[9]=c(" 追踪变更演示",-1))]),_:1}),e(i,null,{default:l(()=>[e(T,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=s=>V.value=s),label:"实体类型",class:"mb-3"},null,8,["modelValue"]),e(T,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),label:"实体 ID (可留空自动生成)",class:"mb-3"},null,8,["modelValue"]),e(q,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=s=>R.value=s),label:"变更类型",options:I,class:"mb-3"},null,8,["modelValue"]),e(S,{color:"success",block:"",onClick:M},{default:l(()=>[e(o,{name:"add",class:"mr-1"}),t[10]||(t[10]=c(" 追踪变更 ",-1))]),_:1})]),_:1})]),_:1})]),a("div",se,[e(r,{class:"mb-4"},{default:l(()=>[e(b,null,{default:l(()=>[e(o,{name:"list",class:"mr-2"}),t[11]||(t[11]=c(" 待同步变更 ",-1)),e(S,{size:"small",preset:"secondary",class:"ml-auto",onClick:y,loading:C.value},{default:l(()=>[e(o,{name:"refresh"})]),_:1},8,["loading"])]),_:1}),e(i,null,{default:l(()=>[e($,{loading:C.value},{default:l(()=>[k.value.length===0?(m(),f("div",ne,[e(o,{name:"check_circle",size:"2rem",color:"success"}),t[12]||(t[12]=a("p",{class:"mt-2"},"所有变更已同步",-1))])):(m(),B(Q,{key:1},{default:l(()=>[(m(!0),f(F,null,U(k.value,s=>(m(),B(P,{key:s.Id},{default:l(()=>[e(h,{avatar:""},{default:l(()=>[e(G,{text:["C","U","D"][s.Type],color:["success","primary","danger"][s.Type]},null,8,["text","color"])]),_:2},1024),e(h,null,{default:l(()=>[e(z,null,{default:l(()=>[c(u(s.EntityType)+" - "+u(s.EntityId),1)]),_:2},1024),e(z,{caption:""},{default:l(()=>[c(u(N(s.Timestamp)),1)]),_:2},1024)]),_:2},1024),e(h,{icon:""},{default:l(()=>[e(S,{size:"small",preset:"secondary",onClick:me=>O([s.Id])},{default:l(()=>[e(o,{name:"check"})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1},8,["loading"])]),_:1})]),_:1})])]),e(r,{class:"mb-4"},{default:l(()=>[e(b,null,{default:l(()=>[e(o,{name:"settings_suggest",class:"mr-2"}),t[13]||(t[13]=c(" 同步策略",-1))]),_:1}),e(i,null,{default:l(()=>[v.value?.Available?(m(),f("div",oe,[(m(!0),f(F,null,U(v.value.Available,s=>(m(),f("div",{class:"flex md4 xs12",key:s.Name},[e(r,{outlined:"",class:"mb-3"},{default:l(()=>[e(i,null,{default:l(()=>[a("div",de,[e(o,{name:s.Name==="Realtime"?"bolt":s.Name==="Batch"?"layers":"schedule",color:"primary",class:"mr-2"},null,8,["name"]),a("strong",null,u(s.Name),1)]),a("p",ce,u(s.Description),1),a("small",ue,"适用: "+u(s.UseCase),1)]),_:2},1024)]),_:2},1024)]))),128))])):E("",!0)]),_:1})]),_:1}),e(r,null,{default:l(()=>[e(b,null,{default:l(()=>[e(o,{name:"code",class:"mr-2"}),t[14]||(t[14]=c(" 注册示例",-1))]),_:1}),e(i,null,{default:l(()=>[v.value?.Registration?(m(),f("div",ie,[t[15]||(t[15]=a("h4",{class:"mb-2"},"Realtime",-1)),e(D,{language:"csharp",class:"mb-3"},{default:l(()=>[c(u(v.value.Registration.Realtime),1)]),_:1}),t[16]||(t[16]=a("h4",{class:"mb-2"},"Batch",-1)),e(D,{language:"csharp",class:"mb-3"},{default:l(()=>[c(u(v.value.Registration.Batch),1)]),_:1}),t[17]||(t[17]=a("h4",{class:"mb-2"},"Scheduled",-1)),e(D,{language:"csharp"},{default:l(()=>[c(u(v.value.Registration.Scheduled),1)]),_:1})])):E("",!0)]),_:1})]),_:1})])}}});export{pe as default};
